<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ajedrez con Q-Learning</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>â™Ÿï¸ Ajedrez con Q-Learning</h1>
            <p>Entrenamiento automÃ¡tico de IA - Blancas vs Negras</p>
            
            <div class="mode-selector">
                <h3>ğŸ® Modo de Juego</h3>
                <div class="mode-buttons">
                    <button id="btnModeTraining" class="mode-btn active">ğŸ¤– Entrenamiento IA</button>
                    <button id="btnModeHuman" class="mode-btn">ğŸ‘¤ Humano vs IA</button>
                </div>
            </div>
        </header>

        <main>
            <div class="game-section">
                <canvas id="chessCanvas" width="480" height="480"></canvas>
            </div>

            <div class="controls-section">
                <div class="control-panel">
                    <h2>âš™ï¸ Panel de Control</h2>
                    
                    <div class="control-group">
                        <button id="btnStartPause" class="btn btn-primary">â–¶ï¸ Iniciar</button>
                        <button id="btnReset" class="btn btn-secondary">ğŸ”„ Reset</button>
                        <button id="btnResetTraining" class="btn btn-warning">ğŸ—‘ï¸ Reset Entrenamiento</button>
                    </div>

                    <div class="control-group">
                        <label for="speedSlider">Velocidad: <span id="speedValue">1x</span></label>
                        <input type="range" id="speedSlider" min="1" max="100" value="1">
                    </div>

                    <div class="control-group">
                        <label for="epsilonSlider">ExploraciÃ³n (Îµ): <span id="epsilonValue">0.10</span></label>
                        <input type="range" id="epsilonSlider" min="0" max="100" value="10">
                    </div>

                    <div class="control-group">
                        <label for="learningRateSlider">Tasa de aprendizaje (Î±): <span id="learningRateValue">0.10</span></label>
                        <input type="range" id="learningRateSlider" min="1" max="100" value="10">
                    </div>

                    <div class="control-group">
                        <label for="discountSlider">Descuento (Î³): <span id="discountValue">0.90</span></label>
                        <input type="range" id="discountSlider" min="50" max="99" value="90">
                    </div>

                    <div class="control-group">
                        <label for="maxMovesSlider">MÃ¡x movimientos: <span id="maxMovesValue">200</span></label>
                        <input type="range" id="maxMovesSlider" min="50" max="500" value="200">
                    </div>

                    <div class="control-group">
                        <button id="btnExport" class="btn btn-info">ğŸ“¥ Exportar Conocimiento</button>
                        <button id="btnImport" class="btn btn-info">ğŸ“¤ Importar Conocimiento</button>
                        <button id="btnConfigDropbox" class="btn btn-warning">ğŸ“¦ Configurar Dropbox</button>
                    </div>
                </div>

                <div class="metrics-panel">
                    <h2>ğŸ“Š MÃ©tricas</h2>
                    
                    <div class="metric-group">
                        <h3>Estado Actual</h3>
                        <p>Modo: <span id="observationStatus">ğŸ”„ ENTRENANDO</span></p>
                        <p>Partida: <span id="currentGame">0</span></p>
                        <p>Movimiento: <span id="currentMove">0</span></p>
                        <p>Turno: <span id="currentColor">Blancas</span></p>
                    </div>

                    <div class="metric-group">
                        <h3>EstadÃ­sticas Globales</h3>
                        <p>Total partidas: <span id="totalGames">0</span></p>
                        <p>Victorias blancas: <span id="whiteWins">0</span></p>
                        <p>Victorias negras: <span id="blackWins">0</span></p>
                        <p>Tablas: <span id="draws">0</span></p>
                        <p>Total movimientos: <span id="totalMoves">0</span></p>
                        <p>Promedio movimientos/partida: <span id="avgMovesPerGame">0.0</span></p>
                    </div>

                    <div class="metric-group">
                        <h3>EstadÃ­sticas Humanas</h3>
                        <p>Partidas jugadas: <span id="humanGames">0</span></p>
                        <p>Movimientos observados: <span id="humanWins">0</span></p>
                    </div>

                    <div class="metric-group">
                        <h3>Winrate</h3>
                        <p class="white-team">âšª Blancas: <span id="whiteWinrate">0.0%</span></p>
                        <p class="black-team">âš« Negras: <span id="blackWinrate">0.0%</span></p>
                    </div>

                    <div class="metric-group">
                        <h3>Progreso de Entrenamiento</h3>
                        <p>Q-table blancas: <span id="whiteQSize">0</span> estados</p>
                        <p>Entradas blancas: <span id="whiteTotalEntries">0</span></p>
                        <p>Q-table negras: <span id="blackQSize">0</span> estados</p>
                        <p>Entradas negras: <span id="blackTotalEntries">0</span></p>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <p>ğŸ’¡ <strong>Objetivo:</strong> Las blancas y las negras aprenden a jugar ajedrez mediante Q-Learning.</p>
            <p>ğŸ¯ <strong>Reglas:</strong> Movimientos vÃ¡lidos de ajedrez estÃ¡ndar. Jaque mate o ahogado terminan la partida.</p>
            <p>ğŸ§  <strong>IA:</strong> Q-Learning tabular con exploraciÃ³n Îµ-greedy y persistencia en localStorage o Dropbox.</p>
            <p id="storageMode">ğŸ’¾ <strong>Almacenamiento:</strong> <span id="storageModeText">localStorage</span></p>
            <p id="lastBackupContainer" style="display: none;">ğŸ“¦ <strong>Ãšltimo respaldo:</strong> <span id="lastBackup">-</span></p>
            <div id="loadingProgress" style="display: none; margin-top: 10px; padding: 10px; background: rgba(0, 0, 0, 0.1); border-radius: 5px;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <div class="spinner"></div>
                    <span id="loadingText">Cargando...</span>
                </div>
            </div>
            <p>ğŸ’¾ <strong>Conocimiento:</strong> El aprendizaje se guarda automÃ¡ticamente en el navegador o en Dropbox.</p>
            <p>ğŸ“š <strong>Nuevas caracterÃ­sticas:</strong></p>
            <ul>
                <li>âœ“ <strong>En Passant</strong> - Captura especial de peÃ³n</li>
                <li>âœ“ <strong>Regla de 50 movimientos</strong> - Tablas si no hay capturas ni movimientos de peÃ³n en 50 movimientos</li>
                <li>âœ“ <strong>Triple repeticiÃ³n</strong> - Tablas si la posiciÃ³n se repite 3 veces</li>
                <li>âœ“ <strong>PromociÃ³n de peÃ³n con opciones</strong> - Elige pieza basada en heurÃ­stica (reina, torre, alfil o caballo)</li>
                <li>âœ“ <strong>Modo Humano vs IA</strong> - Juega contra el sistema o observa el entrenamiento</li>
                <li>âœ“ <strong>Conocimiento bÃ¡sico</strong> - Carga automÃ¡tica al inicio si la tabla estÃ¡ vacÃ­a</li>
                <li>âœ“ <strong>IntegraciÃ³n con Dropbox</strong> - Guarda el conocimiento en la nube automÃ¡ticamente</li>
            </ul>
            <p>ğŸ“¦ <strong>Instrucciones de Dropbox:</strong> <a href="DROPBOX_SETUP.md" target="_blank">Ver DROPBOX_SETUP.md</a></p>
        </footer>
    </div>

    <script src="js/board.js"></script>
    <script src="js/agents.js"></script>
    <script src="js/training.js"></script>
    <script src="js/engine.js"></script>
    <script src="js/ui.js"></script>
</body>
</html>
